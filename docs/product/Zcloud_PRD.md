# 1      文档介绍

## 1.1         文档的目的

此文档是提供用于软件开发部门和产品设计部门、产品测试部门之间就此产品的需求分析、产品开发、产品设计、测试方案交流的基础；

## 1.2         参考文档

| **序号** | **文档名称** | **作者** | **来源**                                                     |
| -------- | ------------ | -------- | ------------------------------------------------------------ |
| 1        | 产品原型     | 王少帅   | https://lanhuapp.com/web/#/item/project/product?pid=ae53d49b-3634-4b45-86c5-602306d459b9&docId=39f5c399-104a-4781-983a-0f34a7e0d50f&docType=axure&pageId=6190da3959c241c5ba311eea7a3bd897&image_id=39f5c399-104a-4781-983a-0f34a7e0d50f |
| 2        | 产品设计     | 关倩     | https://lanhuapp.com/web/#/item/project/board?pid=ae53d49b-3634-4b45-86c5-602306d459b9&docId=39f5c399-104a-4781-983a-0f34a7e0d50f&docType=axure&pageId=6190da3959c241c5ba311eea7a3bd897&image_id=39f5c399-104a-4781-983a-0f34a7e0d50f |

 

 

## 1.3         产品命名规范

| **产品名称Zcloud** |          |      |
| ------------------ | -------- | ---- |
| 中文名称           | 英文名称 | 备注 |
|                    |          |      |
|                    |          |      |

 

# 2      产品介绍

## 2.1         产品概要说明

Zcloud是基于容器技术的企业级云平台解决方案。结合Kubernetes对企业的物理机、虚机等资源进行统一管理。对企业的应用做统一调度。保证企业的IT系统或门户网站实现高可用、可扩展、易于发布等特性。

结构图如下：

![""](architecture.jpg)


| **序号** | **功能名称** | **概述**                                                     |
| -------- | ------------ | ------------------------------------------------------------ |
| **1**    | **总览**     | 列出平台所有纳管的集群，并可删除和创建集群，查看集群的资源使用情况。 |
| **2**    | **集群管理** | 当前集群概览，维护集群节点，使用命名空间对用户使用资源进行隔离。 |
| **3**    | **应用管理** | Zcloud平台workload，进行Deployment，Statefulset，Deamonset，Cronjob，Job，应用配置等进行管理。 |
| **4**    | **系统管理** | 对Zcloud平台的存储、网络、服务进行管理与展示。               |
| **5**    | **用户管理** | Zcloud平台的用户管理，权限管理。                             |
| **6**    | **系统集群** | 包含helm应用模版，镜像的registery，ELK，监控，DevOps功能。   |

 

## 2.2         产品用户定位

此产品面向的主要是两类人员。一类是面向系统的运维人员，另一类是面向开发人员。因产品所包含的知识面非常广，同时也很专业，所以产品设计和实现时尽量给予简单的界面和完备的帮助，并对重要功能的业务权限要集中、重点控制。

 

## 2.3         产品中的角色

| **角色名称** | **职责描述**                                                 | **使用的功能**                   | **权限等级** |
| ------------ | ------------------------------------------------------------ | -------------------------------- | ------------ |
| 系统管理员   | 对权限进行划分，管理后台用户，对用户进行资源分配，维护基础资源可用。 | 全部                             | 1            |
| 普通用户     | 对权限内的资源有使用权。可维护自行创建的服务等。             | 只能使用指定namespaces下的资源。 | 2            |

 

# 3      产品总体业务流程图

管理员：

 

 

 

 

 

普通用户：

 

 

 

 

 

 

 

# 4      产品功能结构图

 

| **功能** | **子功能（栏目）**              | **功能点**                                                   | **优先级** |
| -------- | ------------------------------- | ------------------------------------------------------------ | ---------- |
| 导航栏   | -                               | 菜单导航收缩<br/> 菜单导航<br/>集群选择<br/>命名空间选择<br/>集群命令行<br/>通知<br/>帮助<br/>用户功能列表<br/>集群事件 |            |
| 总览     | -                               | 集群列表   <br/>创建集群   <br/>删除集群   <br/>进入集群命令行   <br/>重新安装部署集群 |            |
| 集群管理 | 1、概览                         | 展示集群名称、版本、节点数、创建日期   <br/>展示集群资源使用CPU、MEM、POD |            |
|          | 2、命名空间                     | 命名空间列表   <br/>命名空间新建、删除、编辑   <br/>命名空间详情   <br/>命名空间配额 |            |
|          | 3、节点                         | 节点列表，名称，状态，k8s版本，容器版本，CPU，MEM，POD   <br/>节点添加，主机名，IP，角色   <br/>节点删除   <br/>节点详情 |            |
| 应用管理 | 1、无状态应用   （deployment）  | 应用列表   <br/>应用删除   <br/>应用新建，可选创建svc或ingress，添加存储，添加环境变量，   <br/>应用详情，增加副本数 |            |
|          | 2、有状态应用   （statefulset） | 应用列表   <br/>应用删除   <br/>应用新建，可选创建svc或ingress，添加存储，添加环境变量，   <br/>应用详情，增加副本数 |            |
|          | 3、守护进程集   （deamonset）   | 应用列表   <br/>应用删除   <br/>应用新建，可选创建svc或ingress，添加存储，添加环境变量，   <br/>应用详情 |            |
|          | 4、定时任务   （cronjob）       | 任务列表   <br/>任务删除   <br/>任务新建，执行时间设定重启策略，添加存储，添加环境变量，   <br/>任务详情 |            |
|          | 5、任务   （job）               | 任务列表   <br/>任务删除   <br/>任务新建，添加存储，添加环境变量，   <br/>任务详情 |            |
|          | 6、配置字典   （configmap）     | 字典列表   <br/>字典删除   <br/>字典编辑   <br/>字典新建，可添加多个配置文件 |            |
|          | 7、保密字典   （secret）        | 字典列表   <br/>字典删除   <br/>字典编辑   <br/>字典新建，key-value形式 |            |
| 系统管理 | 1、存储                         | 存储列表   <br/>存储新建   <br/>存储编辑                     |            |
|          | 2、网络                         | POD IP使用   <br/>服务IP使用                                 |            |
|          | 3、服务链                       | 对外服务资源   <br/>对内服务资源                             |            |
| 资源申请 | 1、资源申请列表                 | 资源申请新建   <br/>资源申请详情   <br/>资源申请删除   <br/>资源申请审批 |            |

 

 

# 5      功能需求

## 5.1         导航栏

### **5.1.1**    功能原型

*参见1.2* *参考文档*

### **5.1.2**    功能概述

对全局性的功能进行操作，包含菜单导航收缩、菜单导航、集群选择、命名空间选择、集群命令行、通知、帮助、用户功能列表。

### **5.1.3**    功能(业务)流程图

无

### **5.1.4**    功能点清单

| **功能** | **子功能（栏目）** | **功能点描述**       |
| -------- | ------------------ | -------------------- |
| 导航栏   | 导航收缩           | 导航栏收缩           |
|          | 菜单导航           | 总览                 |
|          |                    | 集群管理             |
|          |                    | 应用管理             |
|          |                    | 系统管理             |
|          |                    | 资源申请             |
|          | 集群选择           | 选择要操作的集群     |
|          | 命名空间选择       | 选择要操作的命名空间 |
|          | 集群命令行         | 打开终端模式         |
|          | 通知               | 一些系统消息         |
|          | 帮助               | 平台的使用手册       |
|          | 用户功能列表       | 用户相关功能         |

 

### **5.1.5**    功能详细描述

导航栏收缩：控制导航栏收起或展开，收起时只留图标，展示开显示图标加文字。

菜单导航：这里只包含两种逻辑，没有选择集群和已选择集群。当没有选择集群时，只显示总览与资源申请。当选择集群后，要显示所有菜单。

集群选择：下拉菜单，列出该用户权限内的所有集群。

命名空间选择：下拉菜单，列出该用户权限内的所有命名空间。

集群命令行：只有选择集群后，此按钮才可用。为了方便用户在任何操作页面可以随时进入集群命令行设计。

通知：zcloud产生的通知，为集群产行的告警等消息。

帮助：zcloud使用帮助手册。

用户功能：用户编辑、用户详情、修改密码、用户列表、注销。

### **5.1.6**    业务数据描述

1、角色信息（角色名称、角色描述）

角色名称：20个英文字符

角色描述：50个中文字符

角色权限：复选框选择

 

2、用户信息（用户名、备注、集群权限）

 

​    用户名： 由字母a～z(不区分大小写)、数字0～9、点、减号或下划线组成。只能以数字或字母开头和结尾 用户名长度为4～20个字符。

​    登陆密码：6到16个字符。机器生成

 

## 5.2         总览

### **5.2.1**    原型

*参见原型地址。*

### **5.2.2**    功能概述

展示所有已被zcloud纳管的集群列表。

 

### **5.2.3**    功能点清单

| **功能** | **子功能（栏目）** | **功能点描述**                                               |
| -------- | ------------------ | ------------------------------------------------------------ |
| 总览     | -                  | 集群列表   <br/>创建集群   <br/>编辑集群   <br/>删除集群   <br/>集群命令行   <br/>重新部署集群   <br/>取消操作   <br/>查看安装日志 |

 

### **5.2.4**    功能详细描述

#### **5.2.4.1**      集群列表

**功能点描述：**对zcloud已纳管的集群做概要的信息展示。

**使用角色：**管理员。

具体展示字段，集群状态、集群名称、节点数、CPU使用与总量、内存使用与总量（单位放在表头）、容器数使用与总容量、kubernetes版本、操作（命令行、重新部署、删除、查看安装日志、编辑）

状态包含： 

Ready包括：running、unreachable（失联但已初始化完成，重建连接后会自动变为running，重新连接依赖于前端触发，目前是3s刷新一次）

Unready包括：creating、updating、offline（初始化加载未完成，后端会周期重试，完成后会自动变为running）、createfailed（创建失败）

可通过集群名称进行搜索过滤。

集群整个生命周期内，所有状态的转换关系图。

![""](status.jpg)
#### **5.2.4.2**      创建集群

**功能点描述：**进行集群的创建。

创建参数如下：

集群属性设置：集群名称，集群域名后缀。

Zke设置：zcloud服务IP，zcloud服务端口。

SSH设置：用户名，ssh私钥文件，ssh连接端口。

集群网络设置：服务IP段，POD IP段，flannel或是calico，集群内部DNS IP，转发DNS IP。

私有仓库设置：URL，CA证书，用户名，密码。

添加节点设置：主机名，IP，角色（master和etcd与其它角色互斥）

**使用角色：**管理员。

**描述**

创建集群时，集群状态初始为creating，若创建成功（zcloud可正常访问api server），则集群状态变为running。若失败，集群状态为unavailable。

#### **5.2.4.3**      编辑集群

**功能点描述：**添加或删除集群节点。

添加节点设置：主机名，IP，角色（master和etcd与其它角色互斥）

删除节点：支持批量删除

编辑集群目前只支持节点的变更

**使用角色：**管理员。

**描述**

编辑节点实际上是对集群的update操作，当节点变动时，集群状态会有两种结果running - updating - running成功，这时查看节点数会相应的减少或增加。running - updating -running失败。如果发生失败，添加的节点信息不做保存。并且节点数量不会变。

running与unavailable状态的集群才允许做节点变更。

若集群只剩余一个master节点，则不允许删除master节点；

若集群只剩余一个etcd节点，则不允许删除etcd节点；

若集群只剩余一个worker节点，则不允许删除workder节点；

若想要做节点角色的变更，需要先删除该节点，再加入该节点时，进行角色的选择。

#### **5.2.4.4**      删除集群

**功能点描述：**对集群进行删除操作。

**使用角色：**管理员。

只支持单个集群的删除操作。删除只是把zcloud的集群记录删除，k8s方面不做任何清理。

集群删除：在unreachable，running，unavailable状态下可以操作删除集群。

 

#### **5.2.4.5**      进入集群命令行

**功能点描述：**进入集群的命令行，进行信息的查看操作。

**使用角色：**所有具有该集群权限的用户

**描述**

只有running状态下的集群才可用

#### **5.2.4.7**      取消操作

**功能点描述：**对集群的创建或更新动作进行取消。

**使用角色：**管理员。

**描述**

creating，updating，connecting状态可进行取消操作。

#### **5.2.4.8**      查看创建或更新日志

**功能点描述：**查看创建或更新日志

**使用角色：**管理员。

**描述**

仅creating和updating状态可查看创建/更新日志。日志缓存50条。当创建或更新失败或完成后，日志功能不可用。

 

### **5.2.5**    业务数据描述

1、新建集群信息

集群名称：20位中文字符或英文字符

#### **5.2.5.1**      重新安装部署集群

**功能点描述：**重新初始化集群，或是安装失败进行重新安装。

**使用角色：**管理员。

**描述**

重新部

## 5.3         集群管理

### **5.3.1**    功能原型

*参见原型地址。*

### **5.3.2**    功能概述

对集群的资源使用和基本信息进行展示，维护集群的节点资源与命名空间资源。

 

### **5.3.3**    功能点清单

| **功能** | **子功能（栏目）** | **功能点描述**                                               |
| -------- | ------------------ | ------------------------------------------------------------ |
| 集群管理 | 1、概览            | 展示集群名称、版本、节点数、创建日期   <br/>展示集群资源使用CPU、MEM、POD |
|          | 2、命名空间        | 命名空间列表   <br/>命名空间新建、删除、编辑   <br/>命名空间详情   <br/>命名空间配额 |
|          | 3、节点            | 节点列表，名称，状态，k8s版本，容器版本，CPU，MEM，POD   <br/>节点添加，主机名，IP，角色   <br/>节点删除   <br/>节点详情 |

 

### **5.3.4**    功能详细描述

#### **5.3.4.1**      概览

 

 

#### **5.3.4.2**      命名空间

 

 

#### **5.3.4.3**      节点

 

### **5.3.5**    业务数据描述

命名空间名称：

 

 

 

## 5.4         应用管理

### **5.4.1**    功能原型

*参见原型地址*

### **5.4.2**    功能概述

对集群的workload进行管理，无状态应用（deployment）、有状态应用（statefulset）、守护进程集（deamonset）、定时任务（cronjob）、任务（job）、配置字典（configmap）、保密字典（secret）。

 

 

 

 

### **5.4.3**    功能点清单

|          | **功能**                        | **子功能（栏目）**                                           | **功能点描述** |
| -------- | ------------------------------- | ------------------------------------------------------------ | -------------- |
| 应用管理 | 1、无状态应用   （deployment）  | 应用列表   <br/>应用删除   <br/>应用新建，可选创建svc或ingress，添加存储，添加环境变量，   <br/>应用详情，增加副本数 |                |
|          | 2、有状态应用   （statefulset） | 应用列表   <br/>应用删除   <br/>应用新建，可选创建svc或ingress，添加存储，添加环境变量，   <br/>应用详情，增加副本数 |                |
|          | 3、守护进程集   （deamonset）   | 应用列表   <br/>应用删除   <br/>应用新建，可选创建svc或ingress，添加存储，添加环境变量，   <br/>应用详情 |                |
|          | 4、定时任务   （cronjob）       | 任务列表   <br/>任务删除   <br/>任务新建，执行时间设定重启策略，添加存储，添加环境变量，   <br/>任务详情 |                |
|          | 5、任务   （job）               | 任务列表   <br/>任务删除   <br/>任务新建，添加存储，添加环境变量，   <br/>任务详情 |                |
|          | 6、配置字典   （configmap）     | 字典列表   <br/>字典删除   <br/>字典编辑   <br/>字典新建，可添加多个配置文件 |                |
|          | 7、保密字典   （secret）        | 字典列表   <br/>字典删除   <br/>字典编辑   <br/>字典新建，key-value形式 |                |

 

### **5.4.4**    子功能详细描述

#### **5.4.4.1**      无状态应用

 

#### **5.4.4.2**      有状态应用

 

#### **5.4.4.3**      守护进程集

#### **5.4.4.4**      定时任务

#### **5.4.4.5**      任务

#### **5.4.4.6**      配置字典

#### **5.4.4.7**      保密字典

 

### **5.4.5**    业务数据描述

## 5.5         应用商店

### **5.5.1**    功能原型

*参见原型地址*

### **5.5.2**    功能概述

对集群支持的helm chart进行查看，设置，安装。对已安装的chart可以进行卸载。

 

### **5.5.3**    功能点清单

|          | **功能**           | **子功能（栏目）**                        | **功能点描述** |
| -------- | ------------------ | ----------------------------------------- | -------------- |
| 应用商店 | 1、chart列表       | 展示   <br/>安装                          |                |
|          | 2、已安装chart列表 | 已安装的chart总览   <br/>卸载   <br/>跳转 |                |

资源，资源对应的关系

### **5.5.4**    子功能详细描述

#### **5.5.4.1**      展示

Zcloud启动时，在本地获取应用列表展示， 展示内容：icon，应用名称，描述，详情按钮。高级功能，支持云端列表对比并拉取。

#### **5.5.4.2**      安装

若安装应用，需要输入如下参数：

Statefulset或deployment名称，选择版本，用户名，密码，副本数，svc端口。

同一个chart在同一个namespaces下，可以进行多次安装，需要指定不同的资源名称。

#### **5.5.4.3**        已安装的chart总览

展示的内容如下：icon，statefulset名称，svc端口号，副本数，升级、降级、删除。

#### **5.5.4.4**      卸载

支持一键卸载已安装的chart

#### **5.5.4.5**      跳转

已安装的chart支持跳转到应用管理对应的操作页面。

 

### **5.5.5**    业务数据描述

 

## 5.6         系统管理

### **5.6.1**    功能概述

 

### **5.6.2**    功能点清单

| **功能** | **子功能（栏目）** | **功能点描述**                           |
| -------- | ------------------ | ---------------------------------------- |
| 系统管理 | 1、存储            | 存储列表   <br/>存储新建   <br/>存储编辑 |
|          | 2、网络            | POD IP使用   <br/>服务IP使用             |
|          | 3、服务链          | 对外服务资源   <br/>对内服务资源         |

 

### **5.6.3**    功能详细描述

#### **5.6.3.1**      存储

 

#### **5.6.3.2**      网络

#### **5.6.3.3**      服务链

 

### **5.6.4**    业务数据描述

 

## 5.7         资源申请

### **5.7.1**    功能概述

 

### **5.7.2**    功能点清单

| **功能** | **子功能（栏目）** | **功能点描述**                                               |
| -------- | ------------------ | ------------------------------------------------------------ |
| 系统管理 | 1、资源申请列表    | 资源申请新建   <br/>资源申请详情   <br/>资源申请删除   <br/>资源申请审批 |

 

### **5.7.3**    功能详细描述

#### **5.7.3.1**      资源申请列表

资源申请新建时，在用户添写命名空间后添加6个字符的sha256(username)值，开始的6个字符。

### **5.7.4**    业务数据描述

 

# 6      非功能性需求

## 6.1界面操作需求

整体风格保持一致，功能操作使用按钮，操作在同一界面上完成。

兼容800X600以及以上各分辨率。

## 6.2性能需求

同时支持50个集群的管理，单集群支持1000个节点。

## 6.3安全性需求

高级管理员与普通用户以权限划分不同的操作资源。

## 6.4维护与升级

## 6.5可靠性和健壮性

## 6.6用户文档需求

## 6.7运行环境

浏览器Firfox、chrome

 

 

 

 

 
